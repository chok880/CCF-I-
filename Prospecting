-- üìå ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏Ñ‡πà‡∏™‡∏¥‡πà‡∏á‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer

-- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
local Char = player.Character or player.CharacterAdded:Wait()
local startPos = nil
local isRunning = false
local walkSpeed = 24

-- Cache ‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á)
local shopRemote = nil
local currentTool = nil

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô
local function fastWarp(pos)
    local hrp = Char and Char:FindFirstChild("HumanoidRootPart")
    if hrp and pos then
        hrp.CFrame = CFrame.new(pos)
    end
end

-- ‡∏´‡∏≤ Pan ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß (‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô)
local function findPan()
    if currentTool and currentTool.Parent == Char then
        return currentTool
    end
    
    -- ‡∏´‡∏≤‡πÉ‡∏ô Character ‡∏Å‡πà‡∏≠‡∏ô
    for _, item in pairs(Char:GetChildren()) do
        if item:IsA("Tool") and item.Name:find("Pan") then
            currentTool = item
            return item
        end
    end
    
    -- ‡∏´‡∏≤‡πÉ‡∏ô Backpack
    for _, item in pairs(player.Backpack:GetChildren()) do
        if item:IsA("Tool") and item.Name:find("Pan") then
            player.Character.Humanoid:EquipTool(item)
            currentTool = item
            return item
        end
    end
    return nil
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ç‡∏∏‡∏î‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡πá‡∏ß
local function quickFarm()
    local pan = findPan()
    if not pan then return end
    
    local scripts = pan:FindFirstChild("Scripts")
    if scripts then
        -- ‡πÉ‡∏ä‡πâ spawn ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏£‡∏≠
        task.spawn(function()
            pcall(function() if scripts:FindFirstChild("Pan") then scripts.Pan:InvokeServer() end end)
            pcall(function() if scripts:FindFirstChild("Shake") then scripts.Shake:FireServer() end end)
            pcall(function() if scripts:FindFirstChild("Collect") then scripts.Collect:InvokeServer(1) end end)
        end)
    end
end

-- ‡πÄ‡∏ä‡πá‡∏Ñ Pan ‡πÄ‡∏ï‡πá‡∏° (‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô)
local function isPanFull()
    local fillText = player.PlayerGui:FindFirstChild("ToolUI") 
        and player.PlayerGui.ToolUI:FindFirstChild("FillingPan") 
        and player.PlayerGui.ToolUI.FillingPan:FindFirstChild("FillText")
    
    if fillText then
        local text = fillText.Text:gsub("%s+", "")
        local current, max = text:match("(%d+)/(%d+)")
        if current and max then
            return tonumber(current) >= tonumber(max)
        end
    end
    return false
end

-- ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÄ‡∏ï‡πá‡∏° (‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô)
local function isInventoryFull()
    local invText = player.PlayerGui:FindFirstChild("BackpackGui") 
        and player.PlayerGui.BackpackGui:FindFirstChild("Backpack") 
        and player.PlayerGui.BackpackGui.Backpack:FindFirstChild("Inventory") 
        and player.PlayerGui.BackpackGui.Backpack.Inventory:FindFirstChild("TopButtons") 
        and player.PlayerGui.BackpackGui.Backpack.Inventory.TopButtons:FindFirstChild("Unaffected") 
        and player.PlayerGui.BackpackGui.Backpack.Inventory.TopButtons.Unaffected:FindFirstChild("InventorySize")
    
    if invText then
        local current = invText.Text:match("(%d+)")
        return tonumber(current) and tonumber(current) > 499
    end
    return false
end

-- ‡∏à‡∏∏‡∏î‡∏Ç‡∏≤‡∏¢ (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏™‡∏∏‡∏î)
local sellPoints = {
    Vector3.new(-90, 9, 26),
    Vector3.new(-405, 9, -30),
    Vector3.new(-338, 9, -423),
    Vector3.new(-188, 9, -447)
}

local function getClosestSellPoint()
    local hrp = Char and Char:FindFirstChild("HumanoidRootPart")
    if not hrp then return sellPoints[1] end
    
    local closest = sellPoints[1]
    local minDist = (hrp.Position - sellPoints[1]).Magnitude
    
    for i = 2, #sellPoints do
        local dist = (hrp.Position - sellPoints[i]).Magnitude
        if dist < minDist then
            minDist = dist
            closest = sellPoints[i]
        end
    end
    return closest
end

-- ‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á
local function sellAll()
    if not shopRemote then
        shopRemote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("Shop"):WaitForChild("SellAll")
    end
    
    fastWarp(Vector3.new(13, 25, 62)) -- ‡∏à‡∏∏‡∏î‡∏Ç‡∏≤‡∏¢
    task.wait(0.5)
    shopRemote:InvokeServer()
    task.wait(0.5)
    if startPos then fastWarp(startPos) end
end

-- ‡πÇ‡∏´‡∏•‡∏î UI
local Luna = loadstring(game:HttpGet("https://raw.githubusercontent.com/Nebula-Softworks/Luna-Interface-Suite/refs/heads/master/source.lua"))()
local Window = Luna:CreateWindow({Name = "CK Hub V 1.00", Subtitle = "by ‡∏°‡∏≤‡∏õ‡∏±‡πà‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢"})
local Tab = Window:CreateTab({Name = "Auto Farm", Icon = "view_in_ar"})

-- ‡∏™‡∏£‡πâ‡∏≤‡∏á UI
local posLabel = Tab:CreateLabel({Text = "‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å"})

Tab:CreateToggle({
    Name = "‡πÄ‡∏õ‡∏¥‡∏î Auto Farm",
    CurrentValue = false,
    Callback = function(state) isRunning = state end
})

Tab:CreateButton({
    Name = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á",
    Callback = function()
        local hrp = Char and Char:FindFirstChild("HumanoidRootPart")
        if hrp then
            startPos = hrp.Position
            posLabel:SetText("‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: " .. math.floor(startPos.X) .. ", " .. math.floor(startPos.Z))
        end
    end
})

Tab:CreateSlider({
    Name = "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏î‡∏¥‡∏ô",
    Range = {16, 100},
    CurrentValue = walkSpeed,
    Callback = function(value)
        walkSpeed = value
        if Char and Char:FindFirstChild("Humanoid") then
            Char.Humanoid.WalkSpeed = walkSpeed
        end
    end
})

-- ‡∏•‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å (‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô ‡∏•‡∏î‡πÅ‡∏•‡πá‡∏Ñ)
local lastCheck = 0
task.spawn(function()
    while true do
        if isRunning and Char then
            local now = tick()
            
            -- Farm ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
            quickFarm()
            
            -- ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏∏‡∏Å 0.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡∏•‡∏î‡πÅ‡∏•‡πá‡∏Ñ)
            if now - lastCheck > 0.5 then
                lastCheck = now
                
                -- ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß
                if Char:FindFirstChild("Humanoid") then
                    Char.Humanoid.WalkSpeed = walkSpeed
                end
                
                -- ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÄ‡∏ï‡πá‡∏°
                if isInventoryFull() then
                    sellAll()
                elseif isPanFull() then
                    -- ‡∏ß‡∏≤‡∏õ‡πÑ‡∏õ‡∏à‡∏∏‡∏î‡∏Ç‡∏≤‡∏¢ Pan
                    fastWarp(getClosestSellPoint())
                elseif startPos then
                    -- ‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏∏‡∏î‡∏Ç‡∏∏‡∏î
                    fastWarp(startPos)
                end
            end
        end
        task.wait(0.05) -- ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≤‡∏Å 0.001
    end
end)

-- ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó Character
player.CharacterAdded:Connect(function(newChar)
    Char = newChar
    currentTool = nil -- Reset cache
    
    -- ‡∏ï‡∏±‡πâ‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ
    if not startPos then
        local hrp = Char:WaitForChild("HumanoidRootPart", 10)
        if hrp then
            startPos = hrp.Position
            posLabel:SetText("‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: " .. math.floor(startPos.X) .. ", " .. math.floor(startPos.Z))
        end
    end
end)
