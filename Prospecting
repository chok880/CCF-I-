-- üìå ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer
local Char = player.Character or player.CharacterAdded:Wait()

-- ‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
local startPosition = nil
local autoFarmEnabled = false
local walkSpeed = 16 -- ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏õ
local function warpTo(position)
    if not position then return end
    local hrp = Char and Char:FindFirstChild("HumanoidRootPart")
    if not hrp then
        hrp = Char and Char:WaitForChild("HumanoidRootPart", 5)
        if not hrp then return end
    end
    pcall(function()
        hrp.CFrame = CFrame.new(position)
    end)
    task.wait(0.1)
end

-- ‡πÇ‡∏´‡∏•‡∏î Luna UI
local Luna = loadstring(game:HttpGet("https://raw.githubusercontent.com/Nebula-Softworks/Luna-Interface-Suite/refs/heads/master/source.lua"))()

local Window = Luna:CreateWindow({
    Name = "Ck Hub",
    Subtitle = "by CHOK",
    LoadingEnabled = true
})

-- ‡∏™‡∏£‡πâ‡∏≤‡∏á Tab
local FarmTab = Window:CreateTab({
    Name = "Farm",
    Icon = "view_in_ar",
    ImageSource = "Material"
})

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á Label
local posLabel = FarmTab:CreateLabel({
    Text = "‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏≥: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å",
    Style = 2
})

-- Toggle Auto Farm
FarmTab:CreateToggle({
    Name = "Auto Farm",
    CurrentValue = false,
    Callback = function(state)
        autoFarmEnabled = state
    end
})

-- ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
FarmTab:CreateButton({
    Name = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á",
    Callback = function()
        local hrp = Char and Char:FindFirstChild("HumanoidRootPart")
        if hrp then
            startPosition = hrp.Position
            posLabel:SetText("‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏≥: " .. tostring(startPosition))
        end
    end
})

-- ‡∏õ‡∏∏‡πà‡∏°‡∏ß‡∏≤‡∏õ‡πÑ‡∏õ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
FarmTab:CreateButton({
    Name = "‡∏ß‡∏≤‡∏õ‡πÑ‡∏õ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏≥",
    Callback = function()
        if startPosition then warpTo(startPosition) end
    end
})

-- Slider ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏î‡∏¥‡∏ô
FarmTab:CreateSlider({
    Name = "‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏î‡∏¥‡∏ô",
    Range = {16, 200}, -- 16 = ‡∏õ‡∏Å‡∏ï‡∏¥, 200 = ‡πÄ‡∏£‡πá‡∏ß‡∏°‡∏≤‡∏Å
    Increment = 1,
    CurrentValue = walkSpeed,
    Callback = function(value)
        walkSpeed = value
        if Char and Char:FindFirstChild("Humanoid") then
            Char.Humanoid.WalkSpeed = walkSpeed
        end
    end
})

-- üìå ‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
local sellPoints = {
    Vector3.new(-90.1818, 9, 26.5255),
    Vector3.new(-405.5766, 9, -30.5470),
    Vector3.new(-338.4560, 9, -423.8927),
    Vector3.new(-188.2495, 9, -447.3716)
}

-- üìå ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏≤‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
local function getClosestPoint(pos)
    local closest = nil
    local shortestDist = math.huge
    for _, point in ipairs(sellPoints) do
        local dist = (pos - point).Magnitude
        if dist < shortestDist then
            shortestDist = dist
            closest = point
        end
    end
    return closest
end

-- üìå ‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏•‡∏≠‡∏î Pan + ‡∏ß‡∏≤‡∏õ‡πÑ‡∏õ‡∏à‡∏∏‡∏î‡πÉ‡∏Å‡∏•‡πâ‡∏™‡∏∏‡∏î
local function checkAndWarp()
    local fillText = player.PlayerGui:FindFirstChild("ToolUI") 
        and player.PlayerGui.ToolUI:FindFirstChild("FillingPan") 
        and player.PlayerGui.ToolUI.FillingPan:FindFirstChild("FillText")
    if not fillText then return end

    local text = tostring(fillText.Text):gsub("%s+", "")
    local current, max = text:match("^(%d+)%s*/%s*(%d+)$")

    if current and max then
        current, max = tonumber(current), tonumber(max)
        if current >= max then
            local hrp = Char and Char:FindFirstChild("HumanoidRootPart")
            if hrp then
                local closestPoint = getClosestPoint(hrp.Position)
                if closestPoint then
                    warpTo(closestPoint)
                end
            end
        elseif current < max and startPosition then
            warpTo(startPosition)
        end
    end
end

-- ‡∏ï‡∏£‡∏ß‡∏à Inventory + ‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á
local function checkInventoryAndSell()
    local invText = player.PlayerGui:FindFirstChild("BackpackGui") 
        and player.PlayerGui.BackpackGui:FindFirstChild("Backpack") 
        and player.PlayerGui.BackpackGui.Backpack:FindFirstChild("Inventory") 
        and player.PlayerGui.BackpackGui.Backpack.Inventory:FindFirstChild("TopButtons") 
        and player.PlayerGui.BackpackGui.Backpack.Inventory.TopButtons:FindFirstChild("Unaffected") 
        and player.PlayerGui.BackpackGui.Backpack.Inventory.TopButtons.Unaffected:FindFirstChild("InventorySize")
    if not invText then return end

    local text = tostring(invText.Text):gsub("%s+", "")
    local current, max = text:match("^(%d+)%s*/%s*(%d+)$")

    if current and max then
        current, max = tonumber(current), tonumber(max)
        if current > 499 then
            warpTo(Vector3.new(12.9845, 25, 62.1435)) -- ‡∏à‡∏∏‡∏î‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á
            task.wait(0.2)
            local shopRemote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("Shop"):WaitForChild("SellAll")
            shopRemote:InvokeServer()
            task.wait(0.2)
            if startPosition then warpTo(startPosition) end
        end
    end
end

-- Auto Farm Pans
local function autoFarmPans(character)
    for _, item in pairs(character:GetChildren()) do
        if item:IsA("Tool") and item.Name:sub(-3) == "Pan" then
            local scripts = item:FindFirstChild("Scripts")
            if scripts then
                pcall(function()
                    if scripts:FindFirstChild("Pan") then scripts.Pan:InvokeServer() end
                    if scripts:FindFirstChild("Shake") then scripts.Shake:FireServer() end
                    if scripts:FindFirstChild("Collect") then scripts.Collect:InvokeServer(1) end
                end)
            end
        end
    end
end

-- ‡∏•‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å
task.spawn(function()
    while true do
        if autoFarmEnabled and Char then
            autoFarmPans(Char)
            checkAndWarp()
            checkInventoryAndSell()
            -- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï WalkSpeed ‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤
            if Char:FindFirstChild("Humanoid") then
                Char.Humanoid.WalkSpeed = walkSpeed
            end
        end
        task.wait(0.001) -- ‡∏•‡∏î CPU load
    end
end)

-- ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó Character ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏´‡∏°‡πà‡∏´‡∏•‡∏±‡∏á Respawn
player.CharacterAdded:Connect(function(newChar)
    Char = newChar
    -- ‡∏£‡∏≠ HumanoidRootPart ‡πÇ‡∏´‡∏•‡∏î
    local hrp = Char:WaitForChild("HumanoidRootPart", 5)
    if hrp and not startPosition then
        startPosition = hrp.Position
        posLabel:SetText("‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏≥: " .. tostring(startPosition))
    end
end)
